/*! selectize.js - v0.9.0 | https://github.com/brianreavis/selectize.js | Apache License (v2) */

!function(e,t){"function"==typeof define&&define.amd?define("sifter",t):"object"==typeof exports?module.exports=t():e.Sifter=t()}(this,function(){var e=function(e,t){this.items=e,this.settings=t||{diacritics:!0}};e.prototype.tokenize=function(e){if(e=r(String(e||"").toLowerCase()),!e||!e.length)return[];var t,n,s,u,a=[],f=e.split(/ +/);for(t=0,n=f.length;n>t;t++){if(s=i(f[t]),this.settings.diacritics)for(u in o)o.hasOwnProperty(u)&&(s=s.replace(new RegExp(u,"g"),o[u]));a.push({string:f[t],regex:new RegExp(s,"i")})}return a},e.prototype.iterator=function(e,t){var n;n=s(e)?Array.prototype.forEach||function(e){for(var t=0,n=this.length;n>t;t++)e(this[t],t,this)}:function(e){for(var t in this)this.hasOwnProperty(t)&&e(this[t],t,this)},n.apply(e,[t])},e.prototype.getScoreFunction=function(e,t){var n,r,i,s;n=this,e=n.prepareSearch(e,t),i=e.tokens,r=e.options.fields,s=i.length;var o=function(e,t){var n,r;return e?(e=String(e||""),r=e.search(t.regex),-1===r?0:(n=t.string.length/e.length,0===r&&(n+=.5),n)):0},u=function(){var e=r.length;return e?1===e?function(e,t){return o(t[r[0]],e)}:function(t,n){for(var i=0,s=0;e>i;i++)s+=o(n[r[i]],t);return s/e}:function(){return 0}}();return s?1===s?function(e){return u(i[0],e)}:"and"===e.options.conjunction?function(e){for(var t,n=0,r=0;s>n;n++){if(t=u(i[n],e),0>=t)return 0;r+=t}return r/s}:function(e){for(var t=0,n=0;s>t;t++)n+=u(i[t],e);return n/s}:function(){return 0}},e.prototype.getSortFunction=function(e,n){var r,i,s,o,u,a,f,l,c,h,p;if(s=this,e=s.prepareSearch(e,n),p=!e.query&&n.sort_empty||n.sort,c=function(e,t){return"$score"===e?t.score:s.items[t.id][e]},u=[],p)for(r=0,i=p.length;i>r;r++)(e.query||"$score"!==p[r].field)&&u.push(p[r]);if(e.query){for(h=!0,r=0,i=u.length;i>r;r++)if("$score"===u[r].field){h=!1;break}h&&u.unshift({field:"$score",direction:"desc"})}else for(r=0,i=u.length;i>r;r++)if("$score"===u[r].field){u.splice(r,1);break}for(l=[],r=0,i=u.length;i>r;r++)l.push("desc"===u[r].direction?-1:1);return a=u.length,a?1===a?(o=u[0].field,f=l[0],function(e,n){return f*t(c(o,e),c(o,n))}):function(e,n){var r,i,s;for(r=0;a>r;r++)if(s=u[r].field,i=l[r]*t(c(s,e),c(s,n)))return i;return 0}:null},e.prototype.prepareSearch=function(e,t){if("object"==typeof e)return e;t=n({},t);var r=t.fields,i=t.sort,o=t.sort_empty;return r&&!s(r)&&(t.fields=[r]),i&&!s(i)&&(t.sort=[i]),o&&!s(o)&&(t.sort_empty=[o]),{options:t,query:String(e||"").toLowerCase(),tokens:this.tokenize(e),total:0,items:[]}},e.prototype.search=function(e,t){var n,r,i,s,o=this;return r=this.prepareSearch(e,t),t=r.options,e=r.query,s=t.score||o.getScoreFunction(r),e.length?o.iterator(o.items,function(e,i){n=s(e),(t.filter===!1||n>0)&&r.items.push({score:n,id:i})}):o.iterator(o.items,function(e,t){r.items.push({score:1,id:t})}),i=o.getSortFunction(r,t),i&&r.items.sort(i),r.total=r.items.length,"number"==typeof t.limit&&(r.items=r.items.slice(0,t.limit)),r};var t=function(e,t){return"number"==typeof e&&"number"==typeof t?e>t?1:t>e?-1:0:(e=String(e||"").toLowerCase(),t=String(t||"").toLowerCase(),e>t?1:t>e?-1:0)},n=function(e){var t,n,r,i;for(t=1,n=arguments.length;n>t;t++)if(i=arguments[t])for(r in i)i.hasOwnProperty(r)&&(e[r]=i[r]);return e},r=function(e){return(e+"").replace(/^\s+|\s+$|/g,"")},i=function(e){return(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},s=Array.isArray||$&&$.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},o={a:"[aÀÁÂÃÄÅàáâãäå]",c:"[cÇçćĆčČ]",d:"[dđĐďĎ]",e:"[eÈÉÊËèéêëěĚ]",i:"[iÌÍÎÏìíîï]",n:"[nÑñňŇ]",o:"[oÒÓÔÕÕÖØòóôõöø]",r:"[rřŘ]",s:"[sŠš]",t:"[tťŤ]",u:"[uÙÚÛÜùúûüůŮ]",y:"[yŸÿýÝ]",z:"[zŽž]"};return e}),function(e,t){"function"==typeof define&&define.amd?define("microplugin",t):"object"==typeof exports?module.exports=t():e.MicroPlugin=t()}(this,function(){var e={};e.mixin=function(e){e.plugins={},e.prototype.initializePlugins=function(e){var n,r,i,s=this,o=[];if(s.plugins={names:[],settings:{},requested:{},loaded:{}},t.isArray(e))for(n=0,r=e.length;r>n;n++)"string"==typeof e[n]?o.push(e[n]):(s.plugins.settings[e[n].name]=e[n].options,o.push(e[n].name));else if(e)for(i in e)e.hasOwnProperty(i)&&(s.plugins.settings[i]=e[i],o.push(i));for(;o.length;)s.require(o.shift())},e.prototype.loadPlugin=function(t){var n=this,r=n.plugins,i=e.plugins[t];if(!e.plugins.hasOwnProperty(t))throw new Error('Unable to find "'+t+'" plugin');r.requested[t]=!0,r.loaded[t]=i.fn.apply(n,[n.plugins.settings[t]||{}]),r.names.push(t)},e.prototype.require=function(e){var t=this,n=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(n.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return n.loaded[e]},e.define=function(t,n){e.plugins[t]={name:t,fn:n}}};var t={isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}};return e}),function(e,t){"function"==typeof define&&define.amd?define("selectize",["jquery","sifter","microplugin"],t):"object"==typeof exports?module.exports=t(require("jquery"),require("sifter"),require("microplugin")):e.Selectize=t(e.jQuery,e.Sifter,e.MicroPlugin)}(this,function(e,t,n){var r=function(e,t){if("string"!=typeof t||t.length){var n="string"==typeof t?new RegExp(t,"i"):t,r=function(e){var t=0;if(3===e.nodeType){var i=e.data.search(n);if(i>=0&&e.data.length>0){var s=e.data.match(n),o=document.createElement("span");o.className="highlight";var u=e.splitText(i),a=(u.splitText(s[0].length),u.cloneNode(!0));o.appendChild(a),u.parentNode.replaceChild(o,u),t=1}}else if(1===e.nodeType&&e.childNodes&&!/(script|style)/i.test(e.tagName))for(var f=0;f<e.childNodes.length;++f)f+=r(e.childNodes[f]);return t};return e.each(function(){r(this)})}},i=function(){};i.prototype={on:function(e,t){this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(t)},off:function(e,t){var n=arguments.length;return 0===n?delete this._events:1===n?delete this._events[e]:(this._events=this._events||{},void (e in this._events!=0&&this._events[e].splice(this._events[e].indexOf(t),1)))},trigger:function(e){if(this._events=this._events||{},e in this._events!=0)for(var t=0;t<this._events[e].length;t++)this._events[e][t].apply(this,Array.prototype.slice.call(arguments,1))}},i.mixin=function(e){for(var t=["on","off","trigger"],n=0;n<t.length;n++)e.prototype[t[n]]=i.prototype[t[n]]};var s=/Mac/.test(navigator.userAgent),o=65,u=13,a=27,f=37,l=38,c=80,h=39,p=40,d=78,v=8,m=46,g=16,y=s?91:17,b=s?18:17,w=9,E=1,S=2,x=function(e){return"undefined"!=typeof e},T=function(e){return"undefined"==typeof e||null===e?"":"boolean"==typeof e?e?"1":"0":e+""},N=function(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},C=function(e){return(e+"").replace(/\$/g,"$$$$")},k={};k.before=function(e,t,n){var r=e[t];e[t]=function(){return n.apply(e,arguments),r.apply(e,arguments)}},k.after=function(e,t,n){var r=e[t];e[t]=function(){var t=r.apply(e,arguments);return n.apply(e,arguments),t}};var L=function(t,n){if(!e.isArray(n))return n;var r,i,s={};for(r=0,i=n.length;i>r;r++)n[r].hasOwnProperty(t)&&(s[n[r][t]]=n[r]);return s},A=function(e){var t=!1;return function(){t||(t=!0,e.apply(this,arguments))}},O=function(e,t){var n;return function(){var r=this,i=arguments;window.clearTimeout(n),n=window.setTimeout(function(){e.apply(r,i)},t)}},M=function(e,t,n){var r,i=e.trigger,s={};e.trigger=function(){var n=arguments[0];return-1===t.indexOf(n)?i.apply(e,arguments):void (s[n]=arguments)},n.apply(e,[]),e.trigger=i;for(r in s)s.hasOwnProperty(r)&&i.apply(e,s[r])},_=function(e,t,n,r){e.on(t,n,function(t){for(var n=t.target;n&&n.parentNode!==e[0];)n=n.parentNode;return t.currentTarget=n,r.apply(this,[t])})},D=function(e){var t={};if("selectionStart"in e)t.start=e.selectionStart,t.length=e.selectionEnd-t.start;else if(document.selection){e.focus();var n=document.selection.createRange(),r=document.selection.createRange().text.length;n.moveStart("character",-e.value.length),t.start=n.text.length-r,t.length=r}return t},P=function(e,t,n){var r,i,s={};if(n)for(r=0,i=n.length;i>r;r++)s[n[r]]=e.css(n[r]);else s=e.css();t.css(s)},H=function(t,n){if(!t)return 0;var r=e("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).text(t).appendTo("body");P(n,r,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]);var i=r.width();return r.remove(),i},B=function(e){var t=null,n=function(n){var r,i,s,o,u,a,f,l;n=n||window.event||{},n.metaKey||n.altKey||e.data("grow")!==!1&&(r=e.val(),n.type&&"keydown"===n.type.toLowerCase()&&(i=n.keyCode,s=i>=97&&122>=i||i>=65&&90>=i||i>=48&&57>=i||32===i,i===m||i===v?(l=D(e[0]),l.length?r=r.substring(0,l.start)+r.substring(l.start+l.length):i===v&&l.start?r=r.substring(0,l.start-1)+r.substring(l.start+1):i===m&&"undefined"!=typeof l.start&&(r=r.substring(0,l.start)+r.substring(l.start+1))):s&&(a=n.shiftKey,f=String.fromCharCode(n.keyCode),f=a?f.toUpperCase():f.toLowerCase(),r+=f)),o=e.attr("placeholder")||"",!r.length&&o.length&&(r=o),u=H(r,e)+4,u!==t&&(t=u,e.width(u),e.triggerHandler("resize")))};e.on("keydown keyup update blur",n),n()},j=function(n,r){var i,s,o=this;s=n[0],s.selectize=o,i=window.getComputedStyle?window.getComputedStyle(s,null).getPropertyValue("direction"):s.currentStyle&&s.currentStyle.direction,i=i||n.parents("[dir]:first").attr("dir")||"",e.extend(o,{settings:r,$input:n,tagType:"select"===s.tagName.toLowerCase()?E:S,rtl:/rtl/i.test(i),eventNS:".selectize"+ ++j.count,highlightedValue:null,isOpen:!1,isDisabled:!1,isRequired:n.is("[required]"),isInvalid:!1,isLocked:!1,isFocused:!1,isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:O(o.onSearchChange,r.loadThrottle)}),o.sifter=new t(this.options,{diacritics:r.diacritics}),e.extend(o.options,L(r.valueField,r.options)),delete o.settings.options,e.extend(o.optgroups,L(r.optgroupValueField,r.optgroups)),delete o.settings.optgroups,o.settings.mode=o.settings.mode||(1===o.settings.maxItems?"single":"multi"),"boolean"!=typeof o.settings.hideSelected&&(o.settings.hideSelected="multi"===o.settings.mode),o.initializePlugins(o.settings.plugins),o.setupCallbacks(),o.setupTemplates(),o.setup()};return i.mixin(j),n.mixin(j),e.extend(j.prototype,{setup:function(){var t,n,r,i,o,u,a,f,l,c,h=this,p=h.settings,d=h.eventNS,v=e(window),m=e(document);a=h.settings.mode,f=h.$input.attr("tabindex")||"",l=h.$input.attr("class")||"",t=e("<div>").addClass(p.wrapperClass).addClass(l).addClass(a),n=e("<div>").addClass(p.inputClass).addClass("items").appendTo(t),r=e('<input type="text" autocomplete="off" />').appendTo(n).attr("tabindex",f),u=e(p.dropdownParent||t),i=e("<div>").addClass(p.dropdownClass).addClass(l).addClass(a).hide().appendTo(u),o=e("<div>").addClass(p.dropdownContentClass).appendTo(i),t.css({width:h.$input[0].style.width}),h.plugins.names.length&&(c="plugin-"+h.plugins.names.join(" plugin-"),t.addClass(c),i.addClass(c)),(null===p.maxItems||p.maxItems>1)&&h.tagType===E&&h.$input.attr("multiple","multiple"),h.settings.placeholder&&r.attr("placeholder",p.placeholder),h.$wrapper=t,h.$control=n,h.$control_input=r,h.$dropdown=i,h.$dropdown_content=o,i.on("mouseenter","[data-selectable]",function(){return h.onOptionHover.apply(h,arguments)}),i.on("mousedown","[data-selectable]",function(){return h.onOptionSelect.apply(h,arguments)}),_(n,"mousedown","*:not(input)",function(){return h.onItemSelect.apply(h,arguments)}),B(r),n.on({mousedown:function(){return h.onMouseDown.apply(h,arguments)},click:function(){return h.onClick.apply(h,arguments)}}),r.on({mousedown:function(e){e.stopPropagation()},keydown:function(){return h.onKeyDown.apply(h,arguments)},keyup:function(){return h.onKeyUp.apply(h,arguments)},keypress:function(){return h.onKeyPress.apply(h,arguments)},resize:function(){h.positionDropdown.apply(h,[])},blur:function(){return h.onBlur.apply(h,arguments)},focus:function(){return h.onFocus.apply(h,arguments)}}),m.on("keydown"+d,function(e){h.isCmdDown=e[s?"metaKey":"ctrlKey"],h.isCtrlDown=e[s?"altKey":"ctrlKey"],h.isShiftDown=e.shiftKey}),m.on("keyup"+d,function(e){e.keyCode===b&&(h.isCtrlDown=!1),e.keyCode===g&&(h.isShiftDown=!1),e.keyCode===y&&(h.isCmdDown=!1)}),m.on("mousedown"+d,function(e){if(h.isFocused){if(e.target===h.$dropdown[0]||e.target.parentNode===h.$dropdown[0])return!1;h.$control.has(e.target).length||e.target===h.$control[0]||h.blur()}}),v.on(["scroll"+d,"resize"+d].join(" "),function(){h.isOpen&&h.positionDropdown.apply(h,arguments)}),v.on("mousemove"+d,function(){h.ignoreHover=!1}),this.revertSettings={$children:h.$input.children().detach(),tabindex:h.$input.attr("tabindex")},h.$input.attr("tabindex",-1).hide().after(h.$wrapper),e.isArray(p.items)&&(h.setValue(p.items),delete p.items),h.$input[0].validity&&h.$input.on("invalid"+d,function(e){e.preventDefault(),h.isInvalid=!0,h.refreshState()}),h.updateOriginalInput(),h.refreshItems(),h.refreshState(),h.updatePlaceholder(),h.isSetup=!0,h.$input.is(":disabled")&&h.disable(),h.on("change",this.onChange),h.trigger("initialize"),p.preload===!0&&h.onSearchChange("")},setupTemplates:function(){var t=this,n=t.settings.labelField,r=t.settings.optgroupLabelField,i={optgroup:function(e){return'<div class="optgroup">'+e.html+"</div>"},optgroup_header:function(e,t){return'<div class="optgroup-header">'+t(e[r])+"</div>"},option:function(e,t){return'<div class="option">'+t(e[n])+"</div>"},item:function(e,t){return'<div class="item">'+t(e[n])+"</div>"},option_create:function(e,t){return'<div class="create">Add <strong>'+t(e.input)+"</strong>&hellip;</div>"}};t.settings.render=e.extend({},i,t.settings.render)},setupCallbacks:function(){var e,t,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType"};for(e in n)n.hasOwnProperty(e)&&(t=this.settings[n[e]],t&&this.on(e,t))},onClick:function(e){var t=this;t.isFocused||(t.focus(),e.preventDefault())},onMouseDown:function(t){var n=this,r=t.isDefaultPrevented();e(t.target);if(n.isFocused){if(t.target!==n.$control_input[0])return"single"===n.settings.mode?n.isOpen?n.close():n.open():r||n.setActiveItem(null),!1}else r||window.setTimeout(function(){n.focus()},0)},onChange:function(){this.$input.trigger("change")},onKeyPress:function(e){if(this.isLocked)return e&&e.preventDefault();var t=String.fromCharCode(e.keyCode||e.which);return this.settings.create&&t===this.settings.delimiter?(this.createItem(),e.preventDefault(),!1):void 0},onKeyDown:function(e){var t=(e.target===this.$control_input[0],this);if(t.isLocked)return void (e.keyCode!==w&&e.preventDefault());switch(e.keyCode){case o:if(t.isCmdDown)return void t.selectAll();break;case a:return void t.close();case d:if(!e.ctrlKey)break;case p:if(!t.isOpen&&t.hasOptions)t.open();else if(t.$activeOption){t.ignoreHover=!0;var n=t.getAdjacentOption(t.$activeOption,1);n.length&&t.setActiveOption(n,!0,!0)}return void e.preventDefault();case c:if(!e.ctrlKey)break;case l:if(t.$activeOption){t.ignoreHover=!0;var r=t.getAdjacentOption(t.$activeOption,-1);r.length&&t.setActiveOption(r,!0,!0)}return void e.preventDefault();case u:return t.isOpen&&t.$activeOption&&t.onOptionSelect({currentTarget:t.$activeOption}),void e.preventDefault();case f:return void t.advanceSelection(-1,e);case h:return void t.advanceSelection(1,e);case w:return t.isOpen&&t.$activeOption&&t.onOptionSelect({currentTarget:t.$activeOption}),void (t.settings.create&&t.createItem()&&e.preventDefault());case v:case m:return void t.deleteSelection(e)}return t.isFull()||t.isInputHidden?void e.preventDefault():void 0},onKeyUp:function(e){var t=this;if(t.isLocked)return e&&e.preventDefault();var n=t.$control_input.val()||"";t.lastValue!==n&&(t.lastValue=n,t.onSearchChange(n),t.refreshOptions(),t.trigger("type",n))},onSearchChange:function(e){var t=this,n=t.settings.load;n&&(t.loadedSearches.hasOwnProperty(e)||(t.loadedSearches[e]=!0,t.load(function(r){n.apply(t,[e,r])})))},onFocus:function(e){var t=this;return t.isFocused=!0,t.isDisabled?(t.blur(),e&&e.preventDefault(),!1):void (t.ignoreFocus||("focus"===t.settings.preload&&t.onSearchChange(""),t.$activeItems.length||(t.showInput(),t.setActiveItem(null),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState()))},onBlur:function(){var e=this;e.isFocused=!1,e.ignoreFocus||(e.settings.create&&e.settings.createOnBlur&&e.createItem(!1),e.close(),e.setTextboxValue(""),e.setActiveItem(null),e.setActiveOption(null),e.setCaret(e.items.length),e.refreshState())},onOptionHover:function(e){this.ignoreHover||this.setActiveOption(e.currentTarget,!1)},onOptionSelect:function(t){var n,r,i=this;t.preventDefault&&(t.preventDefault(),t.stopPropagation()),r=e(t.currentTarget),r.hasClass("create")?i.createItem():(n=r.attr("data-value"),n&&(i.lastQuery=null,i.setTextboxValue(""),i.addItem(n),!i.settings.hideSelected&&t.type&&/mouse/.test(t.type)&&i.setActiveOption(i.getOption(n))))},onItemSelect:function(e){var t=this;t.isLocked||"multi"===t.settings.mode&&(e.preventDefault(),t.setActiveItem(e.currentTarget,e))},load:function(e){var t=this,n=t.$wrapper.addClass("loading");t.loading++,e.apply(t,[function(e){t.loading=Math.max(t.loading-1,0),e&&e.length&&(t.addOption(e),t.refreshOptions(t.isFocused&&!t.isInputHidden)),t.loading||n.removeClass("loading"),t.trigger("load",e)}])},setTextboxValue:function(e){this.$control_input.val(e).triggerHandler("update"),this.lastValue=e},getValue:function(){return this.tagType===E&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(e){M(this,["change"],function(){this.clear(),this.addItems(e)})},setActiveItem:function(t,n){var r,i,s,o,u,a,f,l,c=this;if("single"!==c.settings.mode){if(t=e(t),!t.length)return e(c.$activeItems).removeClass("active"),c.$activeItems=[],void (c.isFocused&&c.showInput());if(r=n&&n.type.toLowerCase(),"mousedown"===r&&c.isShiftDown&&c.$activeItems.length){for(l=c.$control.children(".active:last"),o=Array.prototype.indexOf.apply(c.$control[0].childNodes,[l[0]]),u=Array.prototype.indexOf.apply(c.$control[0].childNodes,[t[0]]),o>u&&(f=o,o=u,u=f),i=o;u>=i;i++)a=c.$control[0].childNodes[i],-1===c.$activeItems.indexOf(a)&&(e(a).addClass("active"),c.$activeItems.push(a));n.preventDefault()}else"mousedown"===r&&c.isCtrlDown||"keydown"===r&&this.isShiftDown?t.hasClass("active")?(s=c.$activeItems.indexOf(t[0]),c.$activeItems.splice(s,1),t.removeClass("active")):c.$activeItems.push(t.addClass("active")[0]):(e(c.$activeItems).removeClass("active"),c.$activeItems=[t.addClass("active")[0]]);c.hideInput(),this.isFocused||c.focus()}},setActiveOption:function(t,n,r){var i,s,o,u,a,f=this;f.$activeOption&&f.$activeOption.removeClass("active"),f.$activeOption=null,t=e(t),t.length&&(f.$activeOption=t.addClass("active"),(n||!x(n))&&(i=f.$dropdown_content.height(),s=f.$activeOption.outerHeight(!0),n=f.$dropdown_content.scrollTop()||0,o=f.$activeOption.offset().top-f.$dropdown_content.offset().top+n,u=o,a=o-i+s,o+s>i+n?f.$dropdown_content.stop().animate({scrollTop:a},r?f.settings.scrollDuration:0):n>o&&f.$dropdown_content.stop().animate({scrollTop:u},r?f.settings.scrollDuration:0)))},selectAll:function(){var e=this;"single"!==e.settings.mode&&(e.$activeItems=Array.prototype.slice.apply(e.$control.children(":not(input)").addClass("active")),e.$activeItems.length&&(e.hideInput(),e.close()),e.focus())},hideInput:function(){var e=this;e.setTextboxValue(""),e.$control_input.css({opacity:0,position:"absolute",left:e.rtl?1e4:-1e4}),e.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0}),this.isInputHidden=!1},focus:function(){var e=this;e.isDisabled||(e.ignoreFocus=!0,e.$control_input[0].focus(),window.setTimeout(function(){e.ignoreFocus=!1,e.onFocus()},0))},blur:function(){this.$control_input.trigger("blur")},getScoreFunction:function(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())},getSearchOptions:function(){var e=this.settings,t=e.sortField;return"string"==typeof t&&(t={field:t}),{fields:e.searchField,conjunction:e.searchConjunction,sort:t}},search:function(t){var n,r,i,s=this,o=s.settings,u=this.getSearchOptions();if(o.score&&(i=s.settings.score.apply(this,[t]),"function"!=typeof i))throw new Error('Selectize "score" setting must be a function that returns a function');if(t!==s.lastQuery?(s.lastQuery=t,r=s.sifter.search(t,e.extend(u,{score:i})),s.currentResults=r):r=e.extend(!0,{},s.currentResults),o.hideSelected)for(n=r.items.length-1;n>=0;n--)-1!==s.items.indexOf(T(r.items[n].id))&&r.items.splice(n,1);return r},refreshOptions:function(t){var n,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y;"undefined"==typeof t&&(t=!0);var b=this,w=b.$control_input.val(),E=b.search(w),S=b.$dropdown_content,x=b.$activeOption&&T(b.$activeOption.attr("data-value"));if(o=E.items.length,"number"==typeof b.settings.maxOptions&&(o=Math.min(o,b.settings.maxOptions)),u={},b.settings.optgroupOrder)for(a=b.settings.optgroupOrder,n=0;n<a.length;n++)u[a[n]]=[];else a=[];for(n=0;o>n;n++)for(f=b.options[E.items[n].id],l=b.render("option",f),c=f[b.settings.optgroupField]||"",h=e.isArray(c)?c:[c],i=0,s=h&&h.length;s>i;i++)c=h[i],b.optgroups.hasOwnProperty(c)||(c=""),u.hasOwnProperty(c)||(u[c]=[],a.push(c)),u[c].push(l);for(p=[],n=0,o=a.length;o>n;n++)c=a[n],b.optgroups.hasOwnProperty(c)&&u[c].length?(d=b.render("optgroup_header",b.optgroups[c])||"",d+=u[c].join(""),p.push(b.render("optgroup",e.extend({},b.optgroups[c],{html:d})))):p.push(u[c].join(""));if(S.html(p.join("")),b.settings.highlight&&E.query.length&&E.tokens.length)for(n=0,o=E.tokens.length;o>n;n++)r(S,E.tokens[n].regex);if(!b.settings.hideSelected)for(n=0,o=b.items.length;o>n;n++)b.getOption(b.items[n]).addClass("selected");v=b.settings.create&&E.query.length,v&&(S.prepend(b.render("option_create",{input:w})),y=e(S[0].childNodes[0])),b.hasOptions=E.items.length>0||v,b.hasOptions?(E.items.length>0?(g=x&&b.getOption(x),g&&g.length?m=g:"single"===b.settings.mode&&b.items.length&&(m=b.getOption(b.items[0])),m&&m.length||(m=y&&!b.settings.addPrecedence?b.getAdjacentOption(y,1):S.find("[data-selectable]:first"))):m=y,b.setActiveOption(m),t&&!b.isOpen&&b.open()):(b.setActiveOption(null),t&&b.isOpen&&b.close())},addOption:function(t){var n,r,i,s=this;if(e.isArray(t))for(n=0,r=t.length;r>n;n++)s.addOption(t[n]);else i=T(t[s.settings.valueField]),i&&!s.options.hasOwnProperty(i)&&(s.userOptions[i]=!0,s.options[i]=t,s.lastQuery=null,s.trigger("option_add",i,t))},addOptionGroup:function(e,t){this.optgroups[e]=t,this.trigger("optgroup_add",e,t)},updateOption:function(t,n){var r,i,s,o,u,a,f=this;if(t=T(t),s=T(n[f.settings.valueField]),f.options.hasOwnProperty(t)){if(!s)throw new Error("Value must be set in option data");s!==t&&(delete f.options[t],o=f.items.indexOf(t),-1!==o&&f.items.splice(o,1,s)),f.options[s]=n,u=f.renderCache.item,a=f.renderCache.option,x(u)&&(delete u[t],delete u[s]),x(a)&&(delete a[t],delete a[s]),-1!==f.items.indexOf(s)&&(r=f.getItem(t),i=e(f.render("item",n)),r.hasClass("active")&&i.addClass("active"),r.replaceWith(i)),f.isOpen&&f.refreshOptions(!1)}},removeOption:function(e){var t=this;e=T(e),delete t.userOptions[e],delete t.options[e],t.lastQuery=null,t.trigger("option_remove",e),t.removeItem(e)},clearOptions:function(){var e=this;e.loadedSearches={},e.userOptions={},e.options=e.sifter.items={},e.lastQuery=null,e.trigger("option_clear"),e.clear()},getOption:function(e){return this.getElementWithValue(e,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(t,n){var r=this.$dropdown.find("[data-selectable]"),i=r.index(t)+n;return i>=0&&i<r.length?r.eq(i):e()},getElementWithValue:function(t,n){if(t=T(t))for(var r=0,i=n.length;i>r;r++)if(n[r].getAttribute("data-value")===t)return e(n[r]);return e()},getItem:function(e){return this.getElementWithValue(e,this.$control.children())},addItems:function(t){for(var n=e.isArray(t)?t:[t],r=0,i=n.length;i>r;r++)this.isPending=i-1>r,this.addItem(n[r])},addItem:function(t){M(this,["change"],function(){var n,r,i,s,o=this,u=o.settings.mode;return t=T(t),-1!==o.items.indexOf(t)?void ("single"===u&&o.close()):void (o.options.hasOwnProperty(t)&&("single"===u&&o.clear(),"multi"===u&&o.isFull()||(n=e(o.render("item",o.options[t])),o.items.splice(o.caretPos,0,t),o.insertAtCaret(n),o.refreshState(),o.isSetup&&(i=o.$dropdown_content.find("[data-selectable]"),this.isPending||(r=o.getOption(t),s=o.getAdjacentOption(r,1).attr("data-value"),o.refreshOptions(o.isFocused&&"single"!==u),s&&o.setActiveOption(o.getOption(s))),!i.length||null!==o.settings.maxItems&&o.items.length>=o.settings.maxItems?o.close():o.positionDropdown(),o.updatePlaceholder(),o.trigger("item_add",t,n),o.updateOriginalInput()))))})},removeItem:function(e){var t,n,r,i=this;t="object"==typeof e?e:i.getItem(e),e=T(t.attr("data-value")),n=i.items.indexOf(e),-1!==n&&(t.remove(),t.hasClass("active")&&(r=i.$activeItems.indexOf(t[0]),i.$activeItems.splice(r,1)),i.items.splice(n,1),i.lastQuery=null,!i.settings.persist&&i.userOptions.hasOwnProperty(e)&&i.removeOption(e),n<i.caretPos&&i.setCaret(i.caretPos-1),i.refreshState(),i.updatePlaceholder(),i.updateOriginalInput(),i.positionDropdown(),i.trigger("item_remove",e))},createItem:function(t){var n=this,r=e.trim(n.$control_input.val()||""),i=n.caretPos;if(!r.length)return!1;n.lock(),"undefined"==typeof t&&(t=!0);var s="function"==typeof n.settings.create?this.settings.create:function(e){var t={};return t[n.settings.labelField]=e,t[n.settings.valueField]=e,t},o=A(function(e){if(n.unlock(),e&&"object"==typeof e){var r=T(e[n.settings.valueField]);r&&(n.setTextboxValue(""),n.addOption(e),n.setCaret(i),n.addItem(r),n.refreshOptions(t&&"single"!==n.settings.mode))}}),u=s.apply(this,[r,o]);return"undefined"!=typeof u&&o(u),!0},refreshItems:function(){if(this.lastQuery=null,this.isSetup)for(var e=0;e<this.items.length;e++)this.addItem(this.items);this.refreshState(),this.updateOriginalInput()},refreshState:function(){var e=this,t=e.isRequired&&!e.items.length;t||(e.isInvalid=!1),e.$control_input.prop("required",t),e.refreshClasses()},refreshClasses:function(){var t=this,n=t.isFull(),r=t.isLocked;t.$wrapper.toggleClass("rtl",t.rtl),t.$control.toggleClass("focus",t.isFocused).toggleClass("disabled",t.isDisabled).toggleClass("required",t.isRequired).toggleClass("invalid",t.isInvalid).toggleClass("locked",r).toggleClass("full",n).toggleClass("not-full",!n).toggleClass("input-active",t.isFocused&&!t.isInputHidden).toggleClass("dropdown-active",t.isOpen).toggleClass("has-options",!e.isEmptyObject(t.options)).toggleClass("has-items",t.items.length>0),t.$control_input.data("grow",!n&&!r)},isFull:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(){var e,t,n,r=this;if("select"===r.$input[0].tagName.toLowerCase()){for(n=[],e=0,t=r.items.length;t>e;e++)n.push('<option value="'+N(r.items[e])+'" selected="selected"></option>');n.length||this.$input.attr("multiple")||n.push('<option value="" selected="selected"></option>'),r.$input.html(n.join(""))}else r.$input.val(r.getValue());r.isSetup&&r.trigger("change",r.$input.val())},updatePlaceholder:function(){if(this.settings.placeholder){var e=this.$control_input;this.items.length?e.removeAttr("placeholder"):e.attr("placeholder",this.settings.placeholder),e.triggerHandler("update")}},open:function(){var e=this;e.isLocked||e.isOpen||"multi"===e.settings.mode&&e.isFull()||(e.focus(),e.isOpen=!0,e.refreshState(),e.$dropdown.css({visibility:"hidden",display:"block"}),e.positionDropdown(),e.$dropdown.css({visibility:"visible"}),e.trigger("dropdown_open",e.$dropdown))},close:function(){var e=this,t=e.isOpen;"single"===e.settings.mode&&e.items.length&&e.hideInput(),e.isOpen=!1,e.$dropdown.hide(),e.setActiveOption(null),e.refreshState(),t&&e.trigger("dropdown_close",e.$dropdown)},positionDropdown:function(){var e=this.$control,t="body"===this.settings.dropdownParent?e.offset():e.position();t.top+=e.outerHeight(!0),this.$dropdown.css({width:e.outerWidth(),top:t.top,left:t.left})},clear:function(){var e=this;e.items.length&&(e.$control.children(":not(input)").remove(),e.items=[],e.setCaret(0),e.updatePlaceholder(),e.updateOriginalInput(),e.refreshState(),e.showInput(),e.trigger("clear"))},insertAtCaret:function(t){var n=Math.min(this.caretPos,this.items.length);0===n?this.$control.prepend(t):e(this.$control[0].childNodes[n]).before(t),this.setCaret(n+1)},deleteSelection:function(t){var n,r,i,s,o,u,a,f,l,c=this;if(i=t&&t.keyCode===v?-1:1,s=D(c.$control_input[0]),c.$activeOption&&!c.settings.hideSelected&&(a=c.getAdjacentOption(c.$activeOption,-1).attr("data-value")),o=[],c.$activeItems.length){for(l=c.$control.children(".active:"+(i>0?"last":"first")),u=c.$control.children(":not(input)").index(l),i>0&&u++,n=0,r=c.$activeItems.length;r>n;n++)o.push(e(c.$activeItems[n]).attr("data-value"));t&&(t.preventDefault(),t.stopPropagation())}else(c.isFocused||"single"===c.settings.mode)&&c.items.length&&(0>i&&0===s.start&&0===s.length?o.push(c.items[c.caretPos-1]):i>0&&s.start===c.$control_input.val().length&&o.push(c.items[c.caretPos]));if(!o.length||"function"==typeof c.settings.onDelete&&c.settings.onDelete.apply(c,[o])===!1)return!1;for("undefined"!=typeof u&&c.setCaret(u);o.length;)c.removeItem(o.pop());return c.showInput(),c.positionDropdown(),c.refreshOptions(!0),a&&(f=c.getOption(a),f.length&&c.setActiveOption(f)),!0},advanceSelection:function(e,t){var n,r,i,s,o,u,a=this;0!==e&&(a.rtl&&(e*=-1),n=e>0?"last":"first",r=D(a.$control_input[0]),a.isFocused&&!a.isInputHidden?(s=a.$control_input.val().length,o=0>e?0===r.start&&0===r.length:r.start===s,o&&!s&&a.advanceCaret(e,t)):(u=a.$control.children(".active:"+n),u.length&&(i=a.$control.children(":not(input)").index(u),a.setActiveItem(null),a.setCaret(e>0?i+1:i))))},advanceCaret:function(e,t){var n,r,i=this;0!==e&&(n=e>0?"next":"prev",i.isShiftDown?(r=i.$control_input[n](),r.length&&(i.hideInput(),i.setActiveItem(r),t&&t.preventDefault())):i.setCaret(i.caretPos+e))},setCaret:function(t){var n=this;t="single"===n.settings.mode?n.items.length:Math.max(0,Math.min(n.items.length,t));var r,i,s,o;for(s=n.$control.children(":not(input)"),r=0,i=s.length;i>r;r++)o=e(s[r]).detach(),t>r?n.$control_input.before(o):n.$control.append(o);n.caretPos=t},lock:function(){this.close(),this.isLocked=!0,this.refreshState()},unlock:function(){this.isLocked=!1,this.refreshState()},disable:function(){var e=this;e.$input.prop("disabled",!0),e.isDisabled=!0,e.lock()},enable:function(){var e=this;e.$input.prop("disabled",!1),e.isDisabled=!1,e.unlock()},destroy:function(){var t=this,n=t.eventNS,r=t.revertSettings;t.trigger("destroy"),t.off(),t.$wrapper.remove(),t.$dropdown.remove(),t.$input.html("").append(r.$children).removeAttr("tabindex").attr({tabindex:r.tabindex}).show(),e(window).off(n),e(document).off(n),e(document.body).off(n),delete t.$input[0].selectize},render:function(e,t){var n,r,i="",s=!1,o=this,u=/^[\t ]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;return("option"===e||"item"===e)&&(n=T(t[o.settings.valueField]),s=!!n),s&&(x(o.renderCache[e])||(o.renderCache[e]={}),o.renderCache[e].hasOwnProperty(n))?o.renderCache[e][n]:(i=o.settings.render[e].apply(this,[t,N]),("option"===e||"option_create"===e)&&(i=i.replace(u,"<$1 data-selectable")),"optgroup"===e&&(r=t[o.settings.optgroupValueField]||"",i=i.replace(u,'<$1 data-group="'+C(N(r))+'"')),("option"===e||"item"===e)&&(i=i.replace(u,'<$1 data-value="'+C(N(n||""))+'"')),s&&(o.renderCache[e][n]=i),i)}}),j.count=0,j.defaults={plugins:[],delimiter:",",persist:!0,diacritics:!0,create:!1,createOnBlur:!1,highlight:!0,openOnFocus:!0,maxOptions:1e3,maxItems:null,hideSelected:null,addPrecedence:!1,preload:!1,scrollDuration:60,loadThrottle:300,dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",optgroupOrder:null,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,render:{}},e.fn.selectize=function(t){var n=e.fn.selectize.defaults,r=e.extend({},n,t),i=r.dataAttr,s=r.labelField,o=r.valueField,u=r.optgroupField,a=r.optgroupLabelField,f=r.optgroupValueField,l=function(t,n){var i,u,a,f,l=e.trim(t.val()||"");if(l.length){for(a=l.split(r.delimiter),i=0,u=a.length;u>i;i++)f={},f[s]=a[i],f[o]=a[i],n.options[a[i]]=f;n.items=a}},c=function(t,n){var r,l,c,h,p=0,d=n.options,v=function(e){var t=i&&e.attr(i);return"string"==typeof t&&t.length?JSON.parse(t):null},m=function(t,r){var i,a;if(t=e(t),i=t.attr("value")||"",i.length){if(d.hasOwnProperty(i))return void (r&&(d[i].optgroup?e.isArray(d[i].optgroup)?d[i].optgroup.push(r):d[i].optgroup=[d[i].optgroup,r]:d[i].optgroup=r));a=v(t)||{},a[s]=a[s]||t.text(),a[o]=a[o]||i,a[u]=a[u]||r,a.$order=++p,d[i]=a,t.is(":selected")&&n.items.push(i)}},g=function(t){var r,i,s,o,u;for(t=e(t),s=t.attr("label"),s&&(o=v(t)||{},o[a]=s,o[f]=s,n.optgroups[s]=o),u=e("option",t),r=0,i=u.length;i>r;r++)m(u[r],s)};for(n.maxItems=t.attr("multiple")?null:1,h=t.children(),r=0,l=h.length;l>r;r++)c=h[r].tagName.toLowerCase(),"optgroup"===c?g(h[r]):"option"===c&&m(h[r])};return this.each(function(){if(!this.selectize){var r,i=e(this),s=this.tagName.toLowerCase(),o={placeholder:i.children('option[value=""]').text()||i.attr("placeholder"),options:{},optgroups:{},items:[]};"select"===s?c(i,o):l(i,o),r=new j(i,e.extend(!0,{},n,o,t)),i.data("selectize",r),i.addClass("selectized")}})},e.fn.selectize.defaults=j.defaults,j.define("drag_drop",function(){if(!e.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if("multi"===this.settings.mode){var t=this;t.lock=function(){var e=t.lock;return function(){var n=t.$control.data("sortable");return n&&n.disable(),e.apply(t,arguments)}}(),t.unlock=function(){var e=t.unlock;return function(){var n=t.$control.data("sortable");return n&&n.enable(),e.apply(t,arguments)}}(),t.setup=function(){var n=t.setup;return function(){n.apply(this,arguments);var r=t.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:t.isLocked,start:function(e,t){t.placeholder.css("width",t.helper.css("width")),r.css({overflow:"visible"})},stop:function(){r.css({overflow:"hidden"});var n=t.$activeItems?t.$activeItems.slice():null,i=[];r.children("[data-value]").each(function(){i.push(e(this).attr("data-value"))}),t.setValue(i),t.setActiveItem(n)}})}}()}}),j.define("dropdown_header",function(t){var n=this;t=e.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(e){return'<div class="'+e.headerClass+'"><div class="'+e.titleRowClass+'"><span class="'+e.labelClass+'">'+e.title+'</span><a href="javascript:void(0)" class="'+e.closeClass+'">&times;</a></div></div>'}},t),n.setup=function(){var r=n.setup;return function(){r.apply(n,arguments),n.$dropdown_header=e(t.html(t)),n.$dropdown.prepend(n.$dropdown_header)}}()}),j.define("optgroup_columns",function(t){var n=this;t=e.extend({equalizeWidth:!0,equalizeHeight:!0},t),this.getAdjacentOption=function(t,n){var r=t.closest("[data-group]").find("[data-selectable]"),i=r.index(t)+n;return i>=0&&i<r.length?r.eq(i):e()},this.onKeyDown=function(){var e=n.onKeyDown;return function(t){var r,i,s,o;return!this.isOpen||t.keyCode!==f&&t.keyCode!==h?e.apply(this,arguments):(n.ignoreHover=!0,o=this.$activeOption.closest("[data-group]"),r=o.find("[data-selectable]").index(this.$activeOption),o=t.keyCode===f?o.prev("[data-group]"):o.next("[data-group]"),s=o.find("[data-selectable]"),i=s.eq(Math.min(s.length-1,r)),void (i.length&&this.setActiveOption(i)))}}();var r=function(){var r,i,s,o,u,a,f;if(f=e("[data-group]",n.$dropdown_content),i=f.length,i&&n.$dropdown_content.width()){if(t.equalizeHeight){for(s=0,r=0;i>r;r++)s=Math.max(s,f.eq(r).height());f.css({height:s})}t.equalizeWidth&&(a=n.$dropdown_content.innerWidth(),o=Math.round(a/i),f.css({width:o}),i>1&&(u=a-o*(i-1),f.eq(i-1).css({width:u})))}};(t.equalizeHeight||t.equalizeWidth)&&(k.after(this,"positionDropdown",r),k.after(this,"refreshOptions",r))}),j.define("remove_button",function(t){if("single"!==this.settings.mode){t=e.extend({label:"&times;",title:"Remove",className:"remove",append:!0},t);var n=this,r='<a href="javascript:void(0)" class="'+t.className+'" tabindex="-1" title="'+N(t.title)+'">'+t.label+"</a>",i=function(e,t){var n=e.search(/(<\/[^>]+>\s*)$/);return e.substring(0,n)+t+e.substring(n)};this.setup=function(){var s=n.setup;return function(){if(t.append){var o=n.settings.render.item;n.settings.render.item=function(){return i(o.apply(this,arguments),r)}}s.apply(this,arguments),this.$control.on("click","."+t.className,function(t){if(t.preventDefault(),!n.isLocked){var r=e(t.currentTarget).parent();n.setActiveItem(r),n.deleteSelection()&&n.setCaret(n.items.length)}})}}()}}),j.define("restore_on_backspace",function(e){var t=this;e.text=e.text||function(e){return e[this.settings.labelField]},this.onKeyDown=function(){var n=t.onKeyDown;return function(t){var r,i;return t.keyCode===v&&""===this.$control_input.val()&&!this.$activeItems.length&&(r=this.caretPos-1,r>=0&&r<this.items.length)?(i=this.options[this.items[r]],this.deleteSelection(t)&&(this.setTextboxValue(e.text.apply(this,[i])),this.refreshOptions(!0)),void t.preventDefault()):n.apply(this,arguments)}}()}),j});